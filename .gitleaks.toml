# ============================================
# Galeria - Gitleaks Configuration
# ============================================
# Secret scanning for preventing credential leaks

title = "Galeria Secret Scanning"

# Extend the default Gitleaks configuration
extend = "default"

# Custom rules for Galeria-specific secrets
[[rules]]
id = "galeria-jwt-secret"
description = "Galeria JWT secret (hardcoded)"
regex = '''(?i)(jwt|access|refresh)[-_]?secret\s*=\s*['"]?[A-Za-z0-9+/=]{20,}['"]?'''
keywords = ["jwt", "secret", "token"]
entropy = 3.5

[[rules]]
id = "galeria-database-url"
description = "Database connection string"
regex = '''(?i)database[-_]?url\s*=\s*['"]?(postgres|postgresql|mysql|mongodb)://[^\s'"]+['"]?'''
keywords = ["database", "url", "connection", "postgres"]

[[rules]]
id = "galeria-api-key"
description = "Generic API key or token"
regex = '''(?i)(api[-_]?(key|token)|secret[-_]?key|access[-_]?token)\s*[:=]\s*['"]?[A-Za-z0-9+/=]{20,}['"]?'''
keywords = ["api", "key", "token", "secret"]

[[rules]]
id = "galeria-redis-password"
description = "Redis password or connection string"
regex = '''(?i)redis[-_]?(password|url)\s*[:=]\s*['"]?[^\s'"]{10,}['"]?'''
keywords = ["redis", "password"]

[[rules]]
id = "galeria-aws-credentials"
description = "AWS credentials"
regex = '''(?i)(aws[-_])?(access[-_]?key|secret[-_]?access[-_]?key)\s*=\s*['"]?[A-Za-z0-9+/=]{20,}['"]?'''
keywords = ["aws", "access", "key", "secret"]

[[rules]]
id = "galeria-r2-storage-key"
description = "Cloudflare R2/S3 storage credentials"
regex = '''(?i)(r2[-_]?)?(account[-_]?id|access[-_]?key|secret[-_]?access[-_]?key)\s*=\s*['"]?[A-Za-z0-9+/=]{20,}['"]?'''
keywords = ["r2", "storage", "s3", "cloudflare"]

# Allow certain patterns (false positives)
[allowlist]
description = "Global allowlist"
# Allow sample/example values
regexes = [
  '''(example|test|demo|sample|localhost|127\.0\.0\.1|your-[-\w]+)''',
  # Environment variable usage (not actual secrets)
  '''process\.env\.[A-Z_]+''',
  # Template strings
  '''`\${[^}]+}`''',
  # Public documentation
  '''['"`]{4}[\\s\\S]*?['"`]{4}''',
]

# Allow specific file patterns
[[allowlist.files]]
description = "Allow example files"
paths = [
  '''\.example$''',
  '''\.sample$''',
  '''\.test$''',
  '''\.spec$''',
  '''/examples/''',
  '''/docs/''',
  '''/tests/''',
  '''/test/''',
]

# Allow specific commit messages
[[allowlist.commitMessages]]
description = "Allow test commits"
regexes = [
  '''(?i)wip''',
  '''(?i)draft''',
  '''(?i)test''',
  '''(?i)example''',
]

# Ignore certain paths
[allowlist.paths]
description = "Ignore test and build artifacts"
paths = [
  "node_modules/**",
  ".next/**",
  "dist/**",
  "build/**",
  "coverage/**",
  "*.min.js",
  "*.min.css",
  ".git/**",
  "*.log",
  "*.lock",
  "package-lock.json",
  "yarn.lock",
  "pnpm-lock.yaml",
  "public/**",
]

# Report configuration
[report]
exclude = [
  "MIT",
  "Apache",
  "BSD",
  "ISC",
]
